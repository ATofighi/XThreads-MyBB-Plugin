<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
 <head>
  <title>XThreads Documentation - Undocumented Features</title>
  <link rel="stylesheet" type="text/css" href="stylesheet.css" />
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
 </head>
 <body>
  <div class="header">
   <h1>XThreads Documentation - Undocumented Features</h1>
   <div class="navbar">
    <a class="navlink" href="index.html">About</a>
    <a class="navlink" href="undoc.html">Undocumented Features</a>
   </div>
  </div>
  
  <div class="content">
   <p>This page will describe a number of things not documented in the interface, due to lack of space or otherwise.</p>
   <h2>Thread Filtering</h2>
   <p>XThreads offers a <code>{$filters_set}</code> array variable on the forumdisplay page when thread filters are used.  This section describes this array.</p>
   <p>The general format to use in templates is something like this: <code>{$filters_set['<span class="token1">key</span>']['<span class="token2">var</span>']}</code>.  <span class="token1">key</span> refers to the filter; for example, if you've enabled filtering on a thread field having a key of &quot;myfield&quot;, the corresponding <span class="token1">key</span> is <em>myfield</em>.  As for <span class="token2">var</span>, the following are available:</p>
   <ul>
    <li><strong>value</strong>: value of selected filter, for example, if the user is filtering &quot;myfield&quot; by &quot;label_a&quot;, sticking <code>{$filters_set['myfield']['value']}</code> in the appropriate template will display <code>label_a</code>.  Note, if an array of filters have been used, this will contain all values selected, separated by commas.</li>
    <li><strong>urlarg</strong>: URL parameter with selected filter, for example, <code>filtertf_myfield=label_a</code></li>
    <li><strong>urlarga</strong>: same as above, but with a preceeding ampersand, eg <code>&amp;amp;filtertf_myfield=label_a</code></li>
    <li><strong>urlargq</strong>: same as above, but with a preceeding question mark, eg <code>?filtertf_myfield=label_a</code></li>
    <li><strong>forminput</strong>: like <em>urlarg</em>, but as a hidden form parameter, eg <code>&lt;input type=&quot;hidden&quot; name=&quot;filtertf_myfield&quot; value=&quot;label_a&quot; /&gt;</code></li>
    <li><strong>selected</strong>: an array, containing the selected value as a key and <code>&nbsp;selected=&quot;selected&quot;</code> as the value (that's a preceeding space before 'selected' there).  Example usage - the appropriate option in the listbox will be selected depending on what filter is being used:
     <div style="margin-left: 1em;"><code>&lt;select name=&quot;filtertf_myfield&quot;&gt;<br />&lt;option value=&quot;label_a&quot;{$filters_set['myfield']['selected']['label_a']}&gt;label_a&lt;/option&gt;<br />&lt;option value=&quot;label_b&quot;{$filters_set['myfield']['selected']['label_b']}&gt;label_b&lt;/option&gt;<br />...<br />&lt;/select&gt;</code></div></li>
    <li><strong>checked</strong>: same as above, but sets value to <code>&nbsp;checked=&quot;checked&quot;</code></li>
    <li><strong>active</strong>: same as above, but sets value to <code>filtertf_active</code> (may be useful for applying a CSS class)</li>
    <li><strong>nullselected</strong>: if filter is NOT set, will set to <code>&nbsp;selected=&quot;selected&quot;</code>, otherwise will be blank</li>
    <li><strong>nullchecked</strong>: if filter is NOT set, will set to <code>&nbsp;checked=&quot;checked&quot;</code>, otherwise will be blank</li>
    <li><strong>nullactive</strong>: if filter is NOT set, will set to <code>filtertf_active</code>, otherwise will be blank</li>
    <li><strong>hiddencss</strong>: puts hidden CSS if filter is set, is blank otherwise; in other words, if this filter is being used at all, this will be set to <code>display: none;</code></li>
    <li><strong>visiblecss</strong>: opposite of the above; set to <code>display: none;</code> if filter is NOT set, or blank otherwise</li>
   </ul>
   <p>There are also some special values for <span class="token1">key</span>, these are:</p>
   <ul>
    <li><strong>__xt_uid</strong>, <strong>__xt_lastposteruid</strong>, <strong>__xt_prefix</strong> and <strong>__xt_icon</strong>: for filtering by uid, lastposteruid, prefix and icon, respectively</li>
    <li><strong>__all</strong>: aggregation of all thread field filters, and uid/lastposteruid/prefix/icon filters (does not include inline search); this doesn't support <em>selected</em>, <em>checked</em> and <em>active</em> as <span class="token2">var</span></li>
    <li><strong>__search</strong>: for inline forum searching, if enabled</li>
   </ul>
   
   <h2>Display Format Fields</h2>
   <p>The <em>Display Format</em>, <em>Display Item Format</em>, <em>Blank Replacement Value</em>, <em>Unviewable Value</em> and replacement values for <em>Formatting Map List</em> have fairly complex display formatting abilities - this section will try to explain how it works.</p>
   <h3>Special Tokens</h3>
   <ul>
    <li><code>{VALUE}</code> - represents the value; not available for <em>Blank Replacement Value</em> as the value is blank here</li>
    <li><code>{RAWVALUE}</code> - as above, but without the sanitisation step (step 5 below) - use with caution!  Only available in <em>Display Item Format</em> and <em>Display Format</em> if multiple values are not allowed.</li>
    <li><code>{VALUE$1}</code>, <code>{VALUE$2}</code>, <code>{VALUE$3}</code> etc - represents captured value components if a capturing <em>Text Mask Filter</em> is defined</li>
    <li><code>{RAWVALUE$1}</code>, <code>{RAWVALUE$2}</code>, <code>{RAWVALUE$3}</code> etc - as above, but values not gone through the sanitiser</li>
    <li>Variables - similar to how they work in MyBB templates, eg <code>{$mybb-&gt;user['username']}</code>; note, these must be surrounded by curly braces as in the preceeding example.  Variables are always in the global scope.</li>
    <li>Conditionals - see the following section</li>
   </ul>
   <h3>Conditionals</h3>
   <p>XThreads supports conditionals in many fields, which are in the same syntax as the <a href="http://mybbhacks.zingaburga.com/showthread.php?tid=464">Template Conditionals plugin</a>.  There are a few differences/notes with the plugin however:</p>
   <ul>
    <li><code>&lt;template ...&gt;</code> calls are not allowed</li>
    <li><code>{VALUE}</code> and similar tokens above are treated as quoted string values, eg <code>&lt;?='This is '.{VALUE}?&gt;</code> is valid syntax</li>
    <li>All variables are auto-global'd - no need to do this explicitly.  Note that, because of this, it won't work correctly with some PHP syntax, such as <code>$$variable</code></li>
    <li>The two functions added in v1.4 of <em>Template Conditionals</em> are named <code>xthreads_phptpl_eval_expr</code> and <code>xthreads_phptpl_eval_text</code></li>
   </ul>
   <p>PHP support is also available, but only if the  <a href="http://mybbhacks.zingaburga.com/showthread.php?tid=260">PHP in Templates plugin</a> is installed and activated (and/or appropriate setting set in <em>cache/xthreads.php</em>); accepts PHP within <code>&lt;?php ... ?&gt;</code> tags, similar to how the plugin works.</p>
   
   <h3>Parse Process</h3>
   <ol>
    <li>If the value is blank, the <em>Blank Replacement Value</em> will be displayed</li>
    <li>If the user is in a group which cannot view the value, the process will continue, however <em>Unviewable Value</em> will be used in place of <em>Display Format</em></li>
    <li>At this point, file thread fields will go off and do its own thing and pass finally through <em>Display Format</em>; other thread fields continue</li>
    <li>If the value matches one defined in the <em>Formatting Value List</em>, the defined replacement will be used here and the following step will be skipped</li>
    <li>The value will be sanitised according to the <em>Display Parsing</em> option chosen, at this point (eg, MyCode parsed)</li>
    <li>If a capturing <em>Text Mask Filter</em> is used, components are captured (from the raw input, not the output of above step) and sent through the sanitiser (as above)</li>
    <li>If multiple values are supported, the above goes into <em>Display Item Format</em>, and the above two steps are repeated for each value.  Once done, all these values are aggregated together, separated by the <em>Multiple Value Delimiter</em></li>
    <li>Finally, the value goes into the <em>Display Format</em>, for display</li>
   </ol>
   
   <h2>Additional Custom Thread Field Variables</h2>
   <p>In addition to the <code>{$GLOBALS['threadfields']['<em>key</em>']}</code> variable (which displays the value of the thread field), there are other values which can be displayed via the additional variable, <code>{$GLOBALS['threadfields<strong style="color: brown;">_x</strong>']['<em>key</em>']['<span class="token1">valuename</span>']}</code> variable, where <span class="token1">valuename</span> can be one of the following:</p>
   <ul>
    <li><strong>title</strong> - displays the title given to the thread field</li>
    <li><strong>desc</strong> - displays the description given to the thread field</li>
    <li><strong>num_values</strong> - displays the number of values stored in this thread - will always be <code>1</code> for non-multivalued fields, or <code>0</code> if no value entered</li>
    <li><strong>num_values_friendly</strong> - formatted version of the above</li>
    <li><strong>value</strong> - reference back to <code>$threadfields['<em>key</em>']</code>, unless the field is a multivalued field, in which case, this is an array of each individual value</li>
   </ul>
   
   <h2>Additional Template Variables</h2>
   <p>XThreads adds some variables which can be used in templates for convenience.</p>
   <ul>
    <li>Thread/forum URL variables through <code>{$forumurl}</code>, <code>{$forumurl_q}</code>, <code>{$threadurl}</code> and <code>{$threadurl_q}</code> (the <code>_q</code> variants append a <code>?</code> or <code>&amp;amp;</code> depending on the context of the URL).  Example: <code>&lt;a href=&quot;{$forumurl_q}filtertf_myfield=something&quot;&gt;filter by something&lt;/a&gt;</code></li>
    <li>Thread start date is evaluated in a variable through <code>{$thread['threaddate']}</code> and <code>{$thread['threadtime']}</code>; available in forumdisplay/showthread/search</li>
   </ul>
   
   <h2>Other</h2>
   <ul>
    <li>Admins can add XThreads attachments by placing the file in the <em>uploads/xthreads_ul/admindrop</em> folder (and not a subfolder of that), and specify the filename (through URL box) using <em>file://</em> prefix.  For example, if an admin tells the system to retrieve the URL <em>file://bigfile.iso</em>, XThreads will <strong>move</strong> the file in <em>uploads/xthreads_ul/admindrop/bigfile.iso</em> to where xtattachments are stored.</li>
    <li>You can force xthreads_attach.php to download a file (as opposed to viewing the file in the browser) by appending <em>?download=1</em> (or <em>&amp;download=1</em> if you're using query strings) to the URL</li>
    <li>A number of &quot;internal variables&quot; can be modified by editing the <em>cache/xthreads.php</em> file.  XThreads needs to be installed for this file to exist.  Note that this file is auto-generated and may be overwritten during an upgrade, however values will be retained.</li>
    <li>Template modifications performed by XThreads can be redone (ie, after you install a new theme) by deactivating and reactivating the plugin (without un/installing)</li>
    <li>XThreads can sort any non-textarea custom thread field in forumdisplay.  This reuses MyBB's sorting system - just that the URL parameter is a little different.
     <br />To sort by a thread field, prefix its key with <code>tf_</code>, for example, <em>forumdisplay.php?fid=2&amp;sortby=tf_myfield</em> will sort the threads by <em>myfield</em>.  File input fields are a bit different, they need to be prefixed with <code>tfa_<span class="token1">component</span>_</code> where <span class="token1">component</span> is either <code>filename</code>, <code>filesize</code>, <code>uploadtime</code>, <code>updatetime</code> or <code>downloads</code>.
     <br />Although XThreads adds this ability transparently (and to the list of default sort bys in the AdminCP), it is up to you to add appropriate options to the forumdisplay sorter listbox, if you want to.
     <br />As this uses MyBB's system, template variables will be the same, eg <code>{$sortsel['tf_myfield']}</code> will be <code>selected=&quot;selected&quot;</code> if sorting by <em>myfield</em>.
     <br />Note that this is not indexed, like MyBB's sorting options aren't, so these custom sorting options can be slow on a large number of threads.
    </li>
    <li>XThreads can filter forumdisplay by thread starter, last poster, thread icon and thread prefix (MyBB 1.6 only); to do this, supply <em>filterxt_<span class="token1">field</span>=<span class="token2">value</span></em> to the URL, where <span class="token1">field</span> is either <em>uid</em>, <em>lastposteruid</em>, <em>icon</em>, <em>prefix</em>.  For example, <em>forumdisplay.php?fid=2&amp;filterxt_uid=1</em></li>
    <li>In a thread field's <em>Display Format Fields</em> (includes <em>Display Format</em>, <em>Display Item Format</em>, <em>Blank Replacement Value</em>, <em>Unviewable Value</em> and replacement values for <em>Formatting Map List</em>), references to other thread fields are possible, only if the <em>Display Order</em> is set lower than the thread field making the reference (for those with the same <em>Display Order</em>, whether or not it'll work will depend on your luck).  For example, if we have two thread fields, the first having a <em>Display Order</em> of 1 and the second having a <em>Display Format</em> of 2, then this second field can refer to the first field via <code>{$GLOBALS['threadfields']['<span class="token1">key</span>']}</code> in any of its <em>Display Format Fields</em> (where <span class="token1">key</span> is the <em>Key</em> of the first thread field, which also isn't a File input field).</li>
    <li>The <em>Value List</em> for Listbox, Option Buttons and Checkboxes input types can have an associated &quot;input display label&quot; - that is, a separate value and label.  This is achieved through the <code>{|}</code> separator, for example:
     <div style="margin-left: 1em;"><code>1{|}Value 1<br />2{|}A second value<br />5{|}&lt;span style=&quot;color: red;&quot;&gt;Some other value&lt;/span&gt;</code></div>
     with a Listbox input would give something like:
     <div style="margin-left: 1em;"><code>&lt;select&gt;<br />&lt;option value=&quot;1&quot;&gt;Value 1&lt;/option&gt;<br />&lt;option value=&quot;2&quot;&gt;A second value&lt;/option&gt;<br />&lt;option value=&quot;5&quot; style=&quot;color: red;&quot;&gt;Some other value&lt;/option&gt;<br />&lt;/select&gt;</code></div>
     Additional notes: <ul>
      <li>XThreads has the special ability with Listbox inputs to use CSS for items if it is surrounded by a <code>&lt;span&gt;</code> tag with a single <code>style</code> property (like above example; for non-Listbox inputs, HTML is accepted anyway)</li>
      <li>This mapping does not affect the output display, so you may wish to use this in conjunction with the <em>Formatting Map List</em> option</li>
      <li>You can override the label of the <em>(Not Set)</em> item by not supplying a value before the separator, eg <code>{|}Blank</code></li>
     </ul>
    </li>
   </ul>
   
   <h2>XThreads Additions</h2>
   <p>Just a list of the stuff XThreads adds:</p>
   <h3>AdminCP UI Additions</h3>
   <ul>
    <li><em>Custom Thread Fields</em> section under the Configuration tab - this is where you can add custom thread fields</li>
	<li><em>XThreads Options</em> section under forum add/edit - this allows you to customise various XThreads options on a per forum basis; XThreads also adds to the list of sorting options, if you have sortable thread fields assigned to the forum</li>
	<li><em>Modify Custom Thread Fields</em> textbox under add/edit Moderator Tools - this allows moderator tools to modify custom thread fields; note that values here are NOT validated and permissions are NOT checked!</li>
	<li><em>Rebuild <code>threadfields</code> cache</em> under <em>Cache Manager</em> for rebuilding XThreads caches</li>
	<li><em>Rebuild XThreads Attachment Thumbnails</em> under <em>Recount &amp; Rebuild</em> for rebuilding thumbnails associated with uploaded XThreads images (also required if you change thumbnail sizes)</li>
	<li><em>Prune XThreads Orphaned Attachments</em> task, which periodically cleans up orphaned XThreads attachments (as well as performs deferred MD5 hashing), similar to MyBB's <em>Find Orphaned Attachments</em></li>
	<li>Folder chmod check under <em>Tools &amp; Maintenance</em>, <em>System Health</em></li>
   </ul>
   <h3>Modified Templates</h3>
   <ul>
    <li><strong>editpost</strong> and <strong>newthread</strong> - adds <code>{$extra_threadfields}</code> to the template, which just displays any added thread fields</li>
    <li><strong>showthread</strong> - inserts <code>{$first_post}</code> before <code>{$posts}</code>; in XThreads, it's possible to customise the first post differently from other posts</li>
    <li><strong>forumdisplay_threadlist</strong>
     <ul>
      <li>insert <code>{$nullthreads}</code> after <code>{$threads}</code>; this is just for display &quot;null threads&quot; if thread grouping is used</li>
      <li>insert <code>{$sort_by_prefix}</code> before the first option in the sorter listbox - this is to give the option to sort threads by thread prefix</li>
      <li>from the above, some other sorting options are added below the Sort By: Views option in the listbox</li>
     </ul>
    </li>
    <li><strong>forumdisplay_threadlist_sortrating</strong> - similar to the above, inserts a sort by number of ratings option to the sorter listbox</li>
   </ul>
   <h3>Added Templates</h3>
   <ul>
    <li><strong>editpost_first</strong> - allows you to have a different <em>editpost</em> template for editing the first post of a thread; defaults to <code>{$editpost}</code> which uses the default <em>editpost</em> template</li>
    <li><strong>forumdisplay_group_sep</strong> and <strong>forumdisplay_thread_null</strong> - for use with thread grouping (is explained if you enable thread grouping); defaults to nothing</li>
    <li><strong>showthread_noreplies</strong> - displayed in the <code>{$posts}</code> variable for <em>showthread</em> only if the thread has no replies; see the comment in the template for more information</li>
    <li><strong>forumdisplay_searchforum_inline</strong> - inline forum searching - you don't need to bother with this unless you want to...</li>
    <li><strong>threadfields_inputrow</strong> - how extra fields are displayed in newthread/editpost (of first post) - don't need to worry about this one either</li>
   </ul>
   <p>Although not an added template, you can create <em>postbit_first*</em> templates to override the various <em>postbit*</em> templates for the first post of a thread.</p>
   
   
  </div>
 </body>
</html>